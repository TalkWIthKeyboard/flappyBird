var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},BackgroundImage=function(t){function e(e){var r=t.call(this)||this;return r.measured=e,r.addimg(),r.addChild(r.imagedata),r}return __extends(e,t),e.prototype.searchImg=function(){var t=parseInt(String(2*Math.random()+1));switch(t){case 2:this.img="bg_day_png";break;case 1:this.img="bg_night_png"}},e.prototype.addimg=function(){this.searchImg(),this.imagedata=new egret.Bitmap(RES.getRes(this.img)),this.imagedata.width=this.measured.stageW,this.imagedata.height=this.measured.stageH},e}(egret.DisplayObjectContainer);__reflect(BackgroundImage.prototype,"BackgroundImage");var Bird=function(t){function e(e,r){var i=t.call(this)||this,o=RES.getRes("bird_json"),a=RES.getRes("bird_png");if(i.mcf=new egret.MovieClipDataFactory(o,a),i.mcf.enableCache=!0,i.addBird(),i.addChild(i.mc),i.mc.x=(e.measured.stageW-i.mc.width)/2-90,i.mc.y=e.measured.stageH/2-80,i.mc.play(-1),r){i.birdBox=new p2.Body({mass:1,position:[i.mc.x,i.mc.y]});var s=new p2.Box({width:i.mc.width,height:i.mc.height});i.birdBox.addShape(s),e.world.addBody(i.birdBox),setInterval(function(){i.mc.x=i.birdBox.position[0],i.mc.y=i.birdBox.position[1],i.mc.rotation=360-180*i.birdBox.angle/Math.PI},1e3/60)}else egret.Tween.get(i.mc,{loop:!0}).to({y:e.measured.stageH/2-60},800).to({y:e.measured.stageH/2-80},800);return i}return __extends(e,t),e.prototype.addBird=function(){var t=parseInt(String(2*Math.random()+1));switch(t){case 1:this.mcValue="one";break;case 2:this.mcValue="two";break;case 3:this.mcValue="three"}this.mc=new egret.MovieClip(this.mcf.generateMovieClipData(this.mcValue))},e.prototype.jump=function(){p2.vec2.add(this.birdBox.force,this.birdBox.force,p2.vec2.fromValues(0,-400))},e.prototype.getBirdBox=function(){return this.birdBox},e.prototype.removeBird=function(t){t.world.removeBody(this.birdBox),this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(Bird.prototype,"Bird");var Column=function(t){function e(e){var r=t.call(this)||this;r.measured=e.measured,r.co1=new egret.Bitmap(RES.getRes("pipe_down_png")),r.co1.scaleY=1.15,r.addChild(r.co1);var i=parseInt(String(Math.random()*r.co1.height)),o=Math.min(r.measured.stageH/6*5-i-200,r.co1.height);r.co1.y=i-r.co1.height,r.co1.x=r.measured.stageW,r.coBox1=new p2.Body({position:[r.co1.x+r.co1.width/2,i/2]});var a=new p2.Box({width:r.co1.width,height:i});r.coBox1.addShape(a),e.world.addBody(r.coBox1),r.co2=new egret.Bitmap(RES.getRes("pipe_up_png")),r.addChild(r.co2),r.co2.scaleY=1.15,r.co2.y=r.measured.stageH/6*5-o,r.co2.x=r.measured.stageW,r.coBox2=new p2.Body({position:[r.co2.x+r.co2.width/2,r.co2.y+o/2]});var s=new p2.Box({width:r.co2.width,height:o});return r.coBox2.addShape(s),e.world.addBody(r.coBox2),r.timer=new egret.Timer(100,0),r.timer.addEventListener(egret.TimerEvent.TIMER,r.start,r),r.timer.start(),r}return __extends(e,t),e.prototype.start=function(){egret.Tween.get(this.co2).to({x:this.co2.x-20},120),egret.Tween.get(this.co1).to({x:this.co1.x-20},120),this.coBox2.position[0]=this.co2.x,this.coBox1.position[0]=this.co1.x},e.prototype.stop=function(){egret.Tween.removeTweens(this),this.timer.reset()},e.prototype.remove=function(t){t.world.removeBody(this.coBox1),t.world.removeBody(this.coBox2),this.parent.removeChild(this)},e.prototype.timeStart=function(){this.timer.start()},e.prototype.timeEnd=function(){this.timer.reset()},e}(egret.DisplayObjectContainer);__reflect(Column.prototype,"Column");var Floor=function(t){function e(e){var r=t.call(this)||this,i=e.measured;r.measured=i,r.imagedata0=new egret.Bitmap(RES.getRes("land_png")),r.imagedata0.width=i.stageW+10,r.imagedata0.height=i.stageH/6,r.imagedata0.anchorOffsetY=r.imagedata0.height,r.imagedata0.anchorOffsetX=r.imagedata0.width,r.imagedata0.y=i.stageH,r.imagedata0.x=0,r.imagedata1=new egret.Bitmap(RES.getRes("land_png")),r.imagedata1.width=i.stageW+10,r.imagedata1.height=i.stageH/6,r.imagedata1.anchorOffsetY=r.imagedata1.height,r.imagedata1.anchorOffsetX=r.imagedata1.width,r.imagedata1.y=i.stageH,r.imagedata1.x=i.stageW+10;var o=new p2.Plane;return r.floorBox=new p2.Body,r.floorBox.position[1]=i.stageH/6*5,r.floorBox.angle=Math.PI,r.floorBox.addShape(o),e.world.addBody(r.floorBox),r.timer=new egret.Timer(100,0),r.timer.addEventListener(egret.TimerEvent.TIMER,r.start,r),r.addChildAt(r.imagedata0,2),r.addChildAt(r.imagedata1,2),r.timer.start(),r}return __extends(e,t),e.prototype.start=function(){this.imagedata0.x<=0&&(this.imagedata0.x=this.imagedata1.x+this.measured.stageW+10),this.imagedata1.x<=0&&(this.imagedata1.x=this.imagedata0.x+this.measured.stageW+10),egret.Tween.get(this.imagedata0).to({x:this.imagedata0.x-20},100),egret.Tween.get(this.imagedata1).to({x:this.imagedata1.x-20},100)},e.prototype.remove=function(t){t.world.removeBody(this.floorBox),this.parent.removeChild(this)},e.prototype.end=function(){egret.Tween.removeTweens(this),this.timer.reset()},e}(egret.DisplayObjectContainer);__reflect(Floor.prototype,"Floor");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){var r=Math.floor(t/e*100);this.textField.text=r.toString()+" %"},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.hasWorld=!1,e.scoreImgList=[],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.init()},e.prototype.init=function(){var t=this;this.measured={stageW:this.stage.stageWidth,stageH:this.stage.stageHeight},this.columnIndex=0,this.score=0,this.makeNumberImg(this.score,!0);var e=new Bird(this,!1),r=this.makeBitMap("text_ready_png",0,-100,1.4,1.4),i=this.makeBitMap("tutorial_png",0,0,1,1);i.touchEnabled=!0,this.addChildAt(i,1),this.addChildAt(r,1),this.addChildAt(e,1),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(o){t.removeChild(r),t.removeChild(i),t.removeChild(e),t.startGame()},this),this.hasWorld||(this.createWorld(),setInterval(function(){t.world.step(.06)})),this.backGourd=new BackgroundImage(this.measured),this.addChildAt(this.backGourd,0),this.floor=new Floor(this),this.addChildAt(this.floor,3)},e.prototype.createWorld=function(){var t=new p2.World;t.sleepMode=p2.World.BODY_SLEEPING,t.gravity=[0,3],this.world=t,this.hasWorld=!0},e.prototype.createGround=function(){var t=egret.MainContext.instance.stage.stageHeight,e=new p2.Plane,r=new p2.Body;r.position[1]=t-100,r.angle=Math.PI,r.addShape(e),this.world.addBody(r)},e.prototype.startGame=function(){var t=this;this.bird=new Bird(this,!0),this.addChildAt(this.bird,5),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.bird.jump,this.bird),this.birdBoxId=this.bird.getBirdBox().id,this.world.on("beginContact",this.onBeginContact,this),this.addAndDeleteColumn(this),this.timer=new egret.Timer(100,0),this.timer.addEventListener(egret.TimerEvent.TIMER,function(){t.bird.x>t.columnList[t.columnIndex].co2.x&&(t.columnIndex++,t.score++,t.makeNumberImg(t.score,!0))},this),this.timer.start()},e.prototype.addAndDeleteColumn=function(t){var e=this;this.columnList=[];var r=new egret.Timer(100,0);r.addEventListener(egret.TimerEvent.TIMER,function(){var t=e.columnList.length;if(0==t||e.columnList[t-1].co2.x<e.measured.stageW-200){var r=new Column(e);e.addChildAt(r,1),e.columnList.push(r),t++}e.columnList[0].x+e.columnList[0].width<=0&&(e.columnList[0].remove(),e.columnList.shift(),e.columnIndex--)},t),r.start()},e.prototype.stopGame=function(){var t=this;this.floor.end(),this.columnList.forEach(function(t){t.timeEnd()}),this.timer.reset(),this.bird.removeBird(this),this.world.off("beginContact",null),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.bird.jump,this.bird);var e=this.makeBitMap("text_game_over_png",0,-200,1.4,1.4),r=this.makeBitMap("score_panel_png",0,0,1.6,1.6),i=this.makeBitMap("button_play_png",0,200,1.4,1.4);this.makeNumberImg(this.score,!1),i.touchEnabled=!0,this.addChildAt(e,3),this.addChildAt(r,3),this.addChildAt(i,3),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(o){t.removeChild(e),t.removeChild(t.backGourd),t.removeChild(r),t.removeChild(i),t.floor.remove(t);for(var a=0;a<t.columnList.length;a++)t.columnList[a].remove(t);t.init()},this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.startAnimation=function(t){var e=this,r=new egret.HtmlTextParser,i=t.map(function(t){return r.parse(t)}),o=this.textfield,a=-1,s=function(){a++,a>=i.length&&(a=0);var t=i[a];o.textFlow=t;var r=egret.Tween.get(o);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(s,e)};s()},e.prototype.onBeginContact=function(t){var e=t.bodyA,r=t.bodyB;(e.id==this.birdBoxId||r.id==this.birdBoxId)&&this.stopGame()},e.prototype.makeBitMap=function(t,e,r,i,o){var a=this.createBitmapByName(t);return a.x=this.measured.stageW/2+e,a.y=this.measured.stageH/2+r,a.scaleX=i,a.scaleY=o,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a},e.prototype.makeNumberImg=function(t,e){for(var r=t,i=0==t?[0]:[],o=0;o<this.scoreImgList.length;o++)this.removeChild(this.scoreImgList[o]);this.scoreImgList=[];for(var a={x:0,y:0,sx:0,sy:0,t:0};0!=r;)i.push(r%10),r=Math.floor(r/10);console.log(i),a=e?{x:0,y:-200,sx:1.4,sy:1.4,t:8}:{x:120,y:-25,sx:1,sy:1,t:4};for(var o=i.length-1;o>=0;o--)this.scoreImgList.push(this.makeBitMap("font_"+i[o]+"_png",a.x,a.y,a.sx,a.sy));switch(i.length){case 2:this.scoreImgList[0].x=this.scoreImgList[0].x-this.scoreImgList[0].width/2-a.t,this.scoreImgList[1].x=this.scoreImgList[1].x+this.scoreImgList[1].width/2+a.t;break;case 3:this.scoreImgList[0].x=this.scoreImgList[0].x-this.scoreImgList[0].width-2*a.t,this.scoreImgList[2].x=this.scoreImgList[2].x+this.scoreImgList[0].width+2*a.t}for(var o=0;o<this.scoreImgList.length;o++)this.addChildAt(this.scoreImgList[o],4)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var p2DebugDraw=function(){function t(t,e){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=8355813,this.COLOR_S=8381823,this.COLOR_BLACK=0,this.COLOR_RED=16711680,this.isDrawAABB=!1,this.factor=30,this.world=t,this.sprite=e}return t.prototype.drawDebug=function(){this.sprite.graphics.clear();for(var t=this.world.bodies.length,e=0;t>e;e++)for(var r=this.world.bodies[e],i=0;i<r.shapes.length;i++){var o=r.shapes[i];this.drawShape(o,r),this.isDrawAABB&&this.drawAABB(r)}t=this.world.constraints.length;for(var a,i=0;t>i;i++)switch(a=this.world.constraints[i],a.type){case p2.Constraint.DISTANCE:this.drawDistanceJoint(a);break;case p2.Constraint.REVOLUTE:this.drawRevoluteJoint(a);break;case p2.Constraint.GEAR:this.drawGearJoint(a);break;case p2.Constraint.PRISMATIC:this.drawPrismaticJoint(a);break;case p2.Constraint.LOCK:this.drawLockJoint(a)}t=this.world.springs.length;for(var s,n=0;t>n;n++)s=this.world.springs[n],s instanceof p2.LinearSpring?this.drawLinearSpring(s):s instanceof p2.RotationalSpring&&this.drawRotationalSpring(s)},t.prototype.drawAABB=function(t){var e=new Array,r=t.aabb.lowerBound[0],i=t.aabb.lowerBound[1],o=t.aabb.upperBound[0],a=t.aabb.upperBound[1];isFinite(r)&&isFinite(i)&&isFinite(o)&&isFinite(a)&&(e.push([r,i],[o,i],[o,a],[r,a]),this.drawConvex(e,this.COLOR_S,1,!1))},t.prototype.drawDistanceJoint=function(t){var e,r=new Array,i=new Array;e=t.distance,t.upperLimitEnabled&&t.upperLimit>e&&(e=t.upperLimit),t.bodyA.toWorldFrame(r,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var o=p2.vec2.subtract([],i,r);p2.vec2.normalize(o,o),p2.vec2.scale(o,o,e);var a=p2.vec2.add([],r,o);this.drawSegment(r,t.bodyA.position,this.COLOR_S),this.drawSegment(i,t.bodyB.position,this.COLOR_S),this.drawVecAt(o,r,this.COLOR_BLACK),t.position>e&&this.drawSegment(i,a,this.COLOR_RED),this.drawCircle(r,3/this.factor,this.COLOR_BLACK),this.drawCircle(a,3/this.factor,this.COLOR_BLACK),t.lowerLimitEnabled&&(p2.vec2.normalize(o,o),p2.vec2.scale(o,o,t.lowerLimit),a=p2.vec2.add([],r,o),this.drawCircle(a,2/this.factor,this.COLOR_BLACK))},t.prototype.drawRevoluteJoint=function(t){var e=new Array,r=new Array;t.bodyA.toWorldFrame(e,t.pivotA),t.bodyB.toWorldFrame(r,t.pivotB),this.drawSegment(t.bodyA.position,e,this.COLOR_S),this.drawSegment(t.bodyB.position,r,this.COLOR_S),this.drawSegment(e,r,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK)},t.prototype.drawGearJoint=function(t){var e=t.bodyA.position,r=t.bodyB.position,i=new Array,o=new Array;t.bodyA.toWorldFrame(i,[20/this.factor,0]),t.bodyB.toWorldFrame(o,[20/this.factor,0]);var a=p2.vec2.subtract([],e,i),s=p2.vec2.subtract([],r,o);this.drawVecAt(a,e,this.COLOR_BLACK,!0),this.drawVecAt(s,r,this.COLOR_BLACK,!0),t.bodyB.toWorldFrame(s,[10*(t.bodyB.angle-t.bodyA.angle-t.angle)/this.factor,0]),this.drawSegment(s,r,this.COLOR_RED)},t.prototype.drawPrismaticJoint=function(t){var e=(t.bodyA.position,t.bodyB.position,new Array),r=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(r,t.localAnchorB);var i=new Array;i=this.toWorldVector(t.localAxisA,t.bodyA);var o=p2.vec2.copy([],i),a=p2.vec2.copy([],i);t.lowerLimitEnabled?p2.vec2.scale(o,i,t.lowerLimit):p2.vec2.scale(o,i,5e3),t.upperLimitEnabled?p2.vec2.scale(a,i,t.upperLimit):p2.vec2.scale(a,i,5e3),this.drawVecAt(o,e,this.COLOR_BLACK,!0),this.drawVecAt(a,e,this.COLOR_BLACK,!0),p2.vec2.add(o,o,e),this.drawCircle(o,2/this.factor,this.COLOR_BLACK,1,!0),p2.vec2.add(a,a,e),this.drawCircle(a,2/this.factor,this.COLOR_BLACK,1,!0)},t.prototype.drawLockJoint=function(t){var e=new Array;new Array;t.bodyA.toWorldFrame(e,t.localOffsetB),this.drawSegment(e,t.bodyA.position,this.COLOR_S),this.drawSegment(e,t.bodyB.position,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK);var r=new Array;t.bodyA.toWorldFrame(r,[20/this.factor,0]),this.drawSegment(r,t.bodyA.position,this.COLOR_BLACK),t.bodyB.toWorldFrame(r,[20/this.factor,0]),this.drawSegment(r,t.bodyB.position,this.COLOR_BLACK)},t.prototype.drawLinearSpring=function(t){var e=new Array,r=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(r,t.localAnchorB);var i=p2.vec2.subtract([],r,e);p2.vec2.normalize(i,i),p2.vec2.scale(i,i,t.restLength);var o=p2.vec2.add([],t.bodyA.position,i);this.drawSegment(o,t.bodyB.position,this.COLOR_RED),this.drawVecAt(i,e,this.COLOR_BLACK),this.drawCircle(e,3/this.factor,this.COLOR_RED),this.drawCircle(o,3/this.factor,this.COLOR_RED)},t.prototype.drawRotationalSpring=function(t){var e=new Array,r=new Array;e=t.bodyA.position,r=t.bodyB.position;var i=new Array,o=new Array;t.bodyA.toWorldFrame(i,[20/this.factor,0]),t.bodyB.toWorldFrame(o,[10*(t.bodyB.angle-t.bodyA.angle-t.restAngle+2)/this.factor,0]);var a=p2.vec2.subtract([],i,e),s=p2.vec2.subtract([],o,r);this.drawVecAt(a,e,this.COLOR_RED,!0),this.drawVecAt(s,r,this.COLOR_RED,!0),t.bodyB.toWorldFrame(o,[20/this.factor,0]),this.drawCircle(i,2/this.factor,this.COLOR_RED),this.drawCircle(o,2/this.factor,this.COLOR_RED)},t.prototype.drawShape=function(t,e,r,i){var r=void 0==r?this.getColor(e):r,i=void 0==i?!0:i;t instanceof p2.Convex?this.drawConvexShape(t,e,r,i):t instanceof p2.Plane?this.drawPlaneShape(t,e,r,i):t instanceof p2.Circle?this.drawCircleShape(t,e,r,i):t instanceof p2.Capsule?this.drawCapsule(t,e,r):t instanceof p2.Particle?this.drawParticle(t,e,r):t instanceof p2.Line?this.drawLine(t,e,r):t instanceof p2.Heightfield&&this.drawHeightfeild(t,e,r)},t.prototype.drawConvexShape=function(t,e,r,i){var o=(e.shapes.indexOf(t),t.position),a=t.angle,s=[],n=this.transformVec(t.vertices[0],o,a);e.toWorldFrame(s,o),e.toWorldFrame(n,n),this.drawSegment(s,n,r);for(var d=new Array,h=t.vertices.length,c=0;h>c;c++)n=this.transformVec(t.vertices[c],o,a),e.toWorldFrame(n,n),d.push(n);this.drawConvex(d,r,.5,i)},t.prototype.drawParticle=function(t,e,r){this.drawCircle(e.position,1/this.factor,r,.5),this.drawCircle(e.position,5/this.factor,r,1,!1)},t.prototype.drawLine=function(t,e,r){var i=t.length,o=new Array,a=new Array;e.toWorldFrame(o,[-i/2,0]),e.toWorldFrame(a,[i/2,0]),this.drawSegment(o,a,r)},t.prototype.drawHeightfeild=function(t,e,r){var i=this.sprite.graphics;i.lineStyle(1,r),i.beginFill(r,.5);var o,a=t.heights,s=t.elementWidth,n=new Array,d=new Array;a.forEach(function(t,r){o=r*s,n=new Array,e.toWorldFrame(n,[o,t]),d.push(n)}),n=new Array,e.toWorldFrame(n,[o,-500]),d.push(n),n=new Array,e.toWorldFrame(n,[0,-500]),d.push(n),n=new Array,e.toWorldFrame(n,[0,0]),d.push(n),this.drawConvex(d,r,.5)},t.prototype.drawCapsule=function(t,e,r){var i=t.length,o=t.radius,a=new Array,s=new Array,n=new Array,d=new Array,h=new Array,c=new Array;e.toWorldFrame(a,[-i/2,-o]),e.toWorldFrame(s,[i/2,-o]),e.toWorldFrame(n,[i/2,o]),e.toWorldFrame(d,[-i/2,o]),e.toWorldFrame(h,[i/2,0]),e.toWorldFrame(c,[-i/2,0]),this.drawCircle(h,o,r,.5),this.drawCircle(c,o,r,.5),this.drawConvex([a,s,n,d],r,.5)},t.prototype.drawCircleShape=function(t,e,r,i){var o=t.position,a=t.angle,s=new Array;e.toWorldFrame(s,o),this.drawCircle(s,t.radius,r,.5,i);var n=this.transformVec([t.radius,0],o,a);e.toWorldFrame(n,n),this.drawSegment(s,n,r)},t.prototype.drawPlaneShape=function(t,e,r,i){var o=new Array,a=new Array;e.shapes.indexOf(t);e.toWorldFrame(o,[1e3,0]),o=this.transformVec(o,t.position,t.angle),a.push(o),o=new Array,e.toWorldFrame(o,[1e3,-1e5]),o=this.transformVec(o,t.position,t.angle),a.push(o),o=new Array,e.toWorldFrame(o,[-1e3,-1e5]),o=this.transformVec(o,t.position,t.angle),a.push(o),o=new Array,e.toWorldFrame(o,[-1e3,0]),o=this.transformVec(o,t.position,t.angle),a.push(o),this.drawConvex(a,r,.5,i)},t.prototype.getColor=function(t){var e=this.COLOR_D_SLEEP;return t.type==p2.Body.KINEMATIC?e=this.COLOR_K:t.type==p2.Body.STATIC?e=this.COLOR_S:t.sleepState==p2.Body.AWAKE&&(e=this.COLOR_D_WAKE),e},t.prototype.drawVecAt=function(t,e,r,i){void 0===i&&(i=!1);var o=p2.vec2.copy([],e),a=p2.vec2.add([],t,e);i&&this.drawCircle(o,3/this.factor,r),this.drawSegment(o,a,r)},t.prototype.drawVecTo=function(t,e,r,i){void 0===i&&(i=!1);var o=p2.vec2.copy([],e),a=p2.vec2.subtract([],e,t);i&&this.drawCircle(o,3/this.factor,r),this.drawSegment(o,a,r)},t.prototype.drawSegment=function(t,e,r){this.sprite.graphics.lineStyle(1,r),this.sprite.graphics.moveTo(t[0]*this.factor,t[1]*this.factor),this.sprite.graphics.lineTo(e[0]*this.factor,e[1]*this.factor)},t.prototype.drawCircle=function(t,e,r,i,o){void 0===i&&(i=1),this.sprite.graphics.lineStyle(1,r),(o||void 0==o)&&this.sprite.graphics.beginFill(r,i),this.sprite.graphics.drawCircle(t[0]*this.factor,t[1]*this.factor,e*this.factor),this.sprite.graphics.endFill()},t.prototype.drawConvex=function(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=!0),this.sprite.graphics.lineStyle(1,e),i&&this.sprite.graphics.beginFill(e,r);var o=t.length,a=t[0];this.sprite.graphics.moveTo(a[0]*this.factor,a[1]*this.factor);for(var s=1;o>=s;s++)a=t[s%o],this.sprite.graphics.lineTo(a[0]*this.factor,a[1]*this.factor);this.sprite.graphics.endFill()},t.prototype.toWorldVector=function(t,e){var r=new Array;return p2.vec2.rotate(r,t,e.angle),r},t.prototype.transformVec=function(t,e,r){var i=new Array;return p2.vec2.rotate(i,t,r),p2.vec2.add(i,i,e),i},t.prototype.drawDotLine=function(t,e,r,i){if(void 0===e&&(e=0),void 0===r&&(r=!1),void 0===i&&(i=30),!(t.length<2)){var o=2/this.factor,a=[];p2.vec2.copy(a,t[0]),this.drawCircle(a,o,e,1,!1);for(var s=0;s<t.length-2;s++){var n=t[s];if(r)for(var d=p2.vec2.distance(a,n);d>i/this.factor;){var h=[];p2.vec2.subtract(h,n,a),p2.vec2.scale(h,h,i/this.factor/d),p2.vec2.add(a,a,h),this.drawCircle(a,o,e,1,!1),d=p2.vec2.distance(a,n)}else this.drawCircle(n,o,e,1,!1)}}},t}();__reflect(p2DebugDraw.prototype,"p2DebugDraw");